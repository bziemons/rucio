name: Pull request test release branch merge

on:
  pull_request:
    branches: [ next ]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - name: Log pull request event workload
      run: |
        jq .pull_request._links.commits.href ${{ github.event_path }} | xargs curl | jq .\[\].sha | python <<EOF
        import sys
        inp = sys.stdin.readlines()
        print("::set-output name=source_commits::" + inp[0] if len(inp) == 1 else f"{inp[0]}..{inp[-1]}")
        EOF
    - uses: bziemons/mergetest-docker-action@master
      with:
        target_branch: master
